
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Jacob's Istio & Service Mesh Tutorial">
      
      
        <meta name="author" content="Jacob Xi">
      
      
        <link rel="canonical" href="https://chao-xi.github.io/jxistiobook/chap5/4Istio_Helm/">
      
      <link rel="icon" href="../../images/logo.jpeg">
      <meta name="generator" content="mkdocs-1.3.0, mkdocs-material-8.5.2">
    
    
      
        <title>第四节 用Helm部署Istio - Jacob Istio & Service Mesh E-Book</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.9f9400aa.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.cbb835fc.min.css">
        
          
          
          <meta name="theme-color" content="#00bdd6">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="cyan" data-md-color-accent="cyan">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#helmistio" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../.." title="Jacob Istio &amp; Service Mesh E-Book" class="md-header__button md-logo" aria-label="Jacob Istio & Service Mesh E-Book" data-md-component="logo">
      
  <img src="../../images/logo.jpeg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Jacob Istio & Service Mesh E-Book
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              第四节 用Helm部署Istio
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/Chao-Xi/jxistiobook.git" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    jxistiobook
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Jacob Istio &amp; Service Mesh E-Book" class="md-nav__button md-logo" aria-label="Jacob Istio & Service Mesh E-Book" data-md-component="logo">
      
  <img src="../../images/logo.jpeg" alt="logo">

    </a>
    Jacob Istio & Service Mesh E-Book
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Chao-Xi/jxistiobook.git" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    jxistiobook
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Welcome
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          第一章: 微服务和 Service Mesh 核心组件
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="第一章: 微服务和 Service Mesh 核心组件" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          第一章: 微服务和 Service Mesh 核心组件
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap1/1chap1_learn_SM/" class="md-nav__link">
        第一节 Service Mesh 学习与架构分析
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap1/2chap1_service_register/" class="md-nav__link">
        第二节 服务注册中心
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap1/3chap1_load_balancer/" class="md-nav__link">
        第三节 负载均衡器
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap1/4chap1_router/" class="md-nav__link">
        第四节 路由器及其限流熔断路由策略
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap1/5chap1_conn_pool/" class="md-nav__link">
        第五节 连接池：阻塞式连接池和多路复用连接池的差异
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap1/6chap1_apigateway_kong/" class="md-nav__link">
        第六节 微服务网关（Kong）：网关在微服务架构中的作用
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap1/7chap1_config_center/" class="md-nav__link">
        第七节 微服务治理的配置中心
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap1/8chap1_trace/" class="md-nav__link">
        第八节 Trace 更快速定位问题
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap1/9chap1_monitor/" class="md-nav__link">
        第九节 利用 Prometheus 和 Grafana 收集监控数据
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          第二章: Service Mesh 实战
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="第二章: Service Mesh 实战" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          第二章: Service Mesh 实战
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap2/1chap2_sm_prods/" class="md-nav__link">
        第一节 Service Mesh 开源产品中的技术选型
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap2/2chap2_sm_envoy/" class="md-nav__link">
        第二节 最常用的数据面 Envoy介绍
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap2/3chap3_isitio_17/" class="md-nav__link">
        第三节 Istio 入门：基于最新 1.7 版本的环境搭建和介绍
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap2/4chap3_xds/" class="md-nav__link">
        第四节 xDS：控制面和数据面的通信桥梁
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap2/5chap3_ingress_egress/" class="md-nav__link">
        第五节 Ingress 和 Egress：入口流量和出口流量控制
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap2/6chap3_canary/" class="md-nav__link">
        第六节 金丝雀发布：金丝雀部署和版本控制
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap2/7chap3_monitor/" class="md-nav__link">
        第七节 如何利用组件做到服务的可观测性
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap2/8chap3_SM_GO_PROJ/" class="md-nav__link">
        第八节 Proj项目落地: Go 实现 Service Mesh
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap2/9chap3_pratice/" class="md-nav__link">
        第九节 Service Mesh 落地和展望
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap2/10chap3_mesh/" class="md-nav__link">
        第十节 Mesh的未来发展与可行性方向
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          第三章: Istio基础教学
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="第三章: Istio基础教学" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          第三章: Istio基础教学
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap3/0Service_Mesh/" class="md-nav__link">
        第一节 服务网格(Service Mesh)是什么?
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap3/1isba_Frame_Tech/" class="md-nav__link">
        第二节 Istio 架构与技术
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap3/2isba_Service_Find/" class="md-nav__link">
        第三节 Istio 服务发现和 Pilot的架构机制
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap3/3isba_Gateway/" class="md-nav__link">
        第四节 Gateway 设计与实现
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap3/4isba_Gray_release/" class="md-nav__link">
        第五节 Istio 灰度发布与技术实现
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap3/5isba_Xds/" class="md-nav__link">
        第六节 xDS协议解析
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap3/6isba_Mixer/" class="md-nav__link">
        第七节 Mixer基础与实现
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          第四章: Istio(1.10.3)-Bookinfo 流量管理
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="第四章: Istio(1.10.3)-Bookinfo 流量管理" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          第四章: Istio(1.10.3)-Bookinfo 流量管理
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap4/1Istio_Intro/" class="md-nav__link">
        第一节 2021 Service Mesh & Istio 介绍/安装(1.10.3)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap4/2Istio_flow_control/" class="md-nav__link">
        第二节 使用 Istio 实现非侵入流量治理
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap4/3Istio_fault_inject/" class="md-nav__link">
        第三节 Istio 流量管理之故障注入
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap4/4Istio_ServiceEntry_issue/" class="md-nav__link">
        第四节 Istio ServiceEntry 的填坑之路
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          第五章: Istio 高级教学与实践
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="第五章: Istio 高级教学与实践" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          第五章: Istio 高级教学与实践
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../1Service_Mesh_Intro/" class="md-nav__link">
        第一节 服务网格的基本特征
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../2Istio_Intro/" class="md-nav__link">
        第二节 Istio 基本介绍
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../3Istro_ServiceM_Prac/" class="md-nav__link">
        第三节 Istio, Service Mesh 快速入门（Istio 1.1.16）
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          第四节 用Helm部署Istio
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        第四节 用Helm部署Istio
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1istio-chart" class="md-nav__link">
    1、Istio Chart概述
  </a>
  
    <nav class="md-nav" aria-label="1、Istio Chart概述">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-1-chartyaml" class="md-nav__link">
    1-1 Chart.yaml
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-2-valuesyaml" class="md-nav__link">
    1-2 values一*.yaml
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-3-requirementsyaml" class="md-nav__link">
    1-3 requirements.yaml
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-4-template_affinitytpl" class="md-nav__link">
    1-4 template/_affinity.tpl
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-5-templatessidecar-injector-configmapyaml" class="md-nav__link">
    1-5 templates/sidecar-injector-configmap.yaml
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-6-templatesconfigmapyaml" class="md-nav__link">
    1-6 templates/configmap.yaml
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-7-templatescrdsyaml" class="md-nav__link">
    1-7 templates/crds.yaml
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-8-charts" class="md-nav__link">
    1-8 charts
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-charts" class="md-nav__link">
    2、 charts全局变量介绍
  </a>
  
    <nav class="md-nav" aria-label="2、 charts全局变量介绍">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2-1-hubtag" class="md-nav__link">
    2-1 hub和tag
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-2-ingressenabled" class="md-nav__link">
    2-2 ingress.enabled
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-3-istio-ingressingress-gateway" class="md-nav__link">
    2-3 Istio并不推荐 ingress的使用方式，建议使用Ingress Gateway, 取而代之
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-4-proxy" class="md-nav__link">
    2-4 Proxy相关参数
  </a>
  
    <nav class="md-nav" aria-label="2-4 Proxy相关参数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1proxyresources" class="md-nav__link">
    1.proxy.resources
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2proxyconcurrency" class="md-nav__link">
    2.proxy.concurrency
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3proxyaccesslogfi1e" class="md-nav__link">
    3.Proxy.accessLogFi1e
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-proxyprivileged" class="md-nav__link">
    4. proxy.privileged
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5proxyenablecoredump" class="md-nav__link">
    5.Proxy.enableCoreDump
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6proxyincludeipranges" class="md-nav__link">
    6.proxy.includeIPRanges
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7-proxyexcludeipranges" class="md-nav__link">
    7. Proxy.excludeIPRanges
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8proxyincludeinboundports" class="md-nav__link">
    8.Proxy.includeInboundPorts
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#9proxyexcludeinboundports" class="md-nav__link">
    9.proxy.excludeInboundports
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#10proxyautoinject" class="md-nav__link">
    10.proxy.autoInject
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#11-proxyenvoystatsd" class="md-nav__link">
    11. proxy.envoyStatsd
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-4-proxy_initimage" class="md-nav__link">
    2-4 proxy_init.image
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-5-imagepullpolicy" class="md-nav__link">
    2-5 imagePullPolicy
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-6-controlplanesecurityenabled" class="md-nav__link">
    2-6 controlPlaneSecurityEnabled
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-7-disablepolicychecks" class="md-nav__link">
    2-7 disablePolicyChecks
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-8-enabletracing" class="md-nav__link">
    2-8 enableTracing
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-9-mtlsenabled" class="md-nav__link">
    2-9 mtls.enabled
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-10-imagepullsecrets" class="md-nav__link">
    2-10 imagePullSecrets
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-11-arch" class="md-nav__link">
    2-11 arch
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-12-onenamespace" class="md-nav__link">
    2-12 oneNamespace
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-13-configvalidation" class="md-nav__link">
    2-13 configValidation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-14-meshexpansion" class="md-nav__link">
    2-14 meshExpansion
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-15-meshexpansionilb" class="md-nav__link">
    2-15 meshExpansionILB
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-16-defaultresources" class="md-nav__link">
    2-16 defaultResources
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-17-hyperkube" class="md-nav__link">
    2-17 hyperkube
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-18-priorityclassname" class="md-nav__link">
    2-18 priorityClassName
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-19-crds" class="md-nav__link">
    2-19 crds
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3istio" class="md-nav__link">
    3、Istio 安装清单的生成和部署
  </a>
  
    <nav class="md-nav" aria-label="3、Istio 安装清单的生成和部署">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#3-1-valuesyaml" class="md-nav__link">
    3-1 编辑values.yaml
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-2" class="md-nav__link">
    3-2 系统资源
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-3" class="md-nav__link">
    3-3 服务类型
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-4" class="md-nav__link">
    3-4 可视化组件的服务开放
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4" class="md-nav__link">
    4、生成部署清单
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5istio" class="md-nav__link">
    5、部署Istio
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6" class="md-nav__link">
    6、小结
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../5Istio_funcs/" class="md-nav__link">
        第五节 Istio 常用功能 （自动/手动部署Istio应用）
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../6Istio_func2_grafana_prometheus/" class="md-nav__link">
        第六节 使用 Istio Dashboard Grafana / Prometheus
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../7Istio_fun3_Jager/" class="md-nav__link">
        第七节 使用 Istio Dashboard
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../8Istio_func4_Kiali/" class="md-nav__link">
        第八节 使用Kiali
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../9Istio_http1/" class="md-nav__link">
        第九节 HTTPS流量管理(目标规则/默认路由/流量的拆分和迁移)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../10Istio_http2/" class="md-nav__link">
        第十节 HTTPS流量管理(金丝雀部署/源服务进行路由/URI进行重定向)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../11Istio_http3/" class="md-nav__link">
        第十一节 HTTPS流量管理（通信超时/故障重试/入口~出口流量管理）
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../12Istio_http4/" class="md-nav__link">
        第十二节 HTTPS流量管理（服务熔断/故障注入测试/注入中断/流量复制)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../13Istio_Mixer1/" class="md-nav__link">
        第十三节 Mixer 适配器的应用(简介/Denier访问控制/Listchecker访问控制)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../14Istio_Mixer2/" class="md-nav__link">
        第十四节 Mixer 适配器的应用(MemQuota服务限流/Mixer对象的定义/RedisQuota服务限流)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../15Istio_Mixer3_prometheus/" class="md-nav__link">
        第十五节 Mixer 适配器的应用 - 为Prometheus定义监控指标
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../16Istio_Mixer4_stdio/" class="md-nav__link">
        第十六节 使用stdio输出自定义日志
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../17Istio_Mixer5_fluentd/" class="md-nav__link">
        第十七节 使用Fluentd输出日志
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../18Istio_Sec1/" class="md-nav__link">
        第十八节 Istio的安全加固（启用mTLS\加固概述)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../19Istio_Sec2_RBAC/" class="md-nav__link">
        第十九节 Istio的安全加固(RBAC设置\拍错）
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../20Istio_Usage/" class="md-nav__link">
        第二十节 Istio的试用建议
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" type="checkbox" id="__nav_7" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7">
          第六章: 实验与教学bookinfo(istio-1.3)-old
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="第六章: 实验与教学bookinfo(istio-1.3)-old" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          第六章: 实验与教学bookinfo(istio-1.3)-old
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap6/1Istio_install_docker/" class="md-nav__link">
        L1 Docker for Mac安装istio(istio-1.3)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap6/2BookInfo_1/" class="md-nav__link">
        L2 基于Bookinfo的流量管理配置(服务版本/基于权重/基于请求内容)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap6/3BookInfo_2/" class="md-nav__link">
        L3 基于Bookinfo的流量管理配置(延迟访问/中断访问/不同环境/服务网格外)
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8" type="checkbox" id="__nav_8" >
      
      
      
      
        <label class="md-nav__link" for="__nav_8">
          第七章: JenkinsX + Istio渐进式交付
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="第七章: JenkinsX + Istio渐进式交付" data-md-level="1">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          第七章: JenkinsX + Istio渐进式交付
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap7/k8s_adv54_release/" class="md-nav__link">
        L1 Kubernetes中的渐进式交付:蓝绿部署和金丝雀部署shipper/Istio/Flagger
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap7/k8s_adv56_jenkinsX/" class="md-nav__link">
        L2 使用 Jenkins X 渐进式交付
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap7/k8s_adv57_Auto_Canary/" class="md-nav__link">
        L3 使用 Jenkins X 渐进式交付:自动化金丝雀部署
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap7/k8s_isitio_gray/" class="md-nav__link">
        L4 使用Rainbond+Istio实现灰度发布
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9" type="checkbox" id="__nav_9" >
      
      
      
      
        <label class="md-nav__link" for="__nav_9">
          第八章: Tetrate Istio基础培训与实验测试
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="第八章: Tetrate Istio基础培训与实验测试" data-md-level="1">
        <label class="md-nav__title" for="__nav_9">
          <span class="md-nav__icon md-icon"></span>
          第八章: Tetrate Istio基础培训与实验测试
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap8/1service_mesh/" class="md-nav__link">
        第一节 服务网格和 Istio 概览
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap8/2Istio_install/" class="md-nav__link">
        第二节 安装 Istio
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap8/3Istio_mon/" class="md-nav__link">
        第三节 可观察性：遥测和日志
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap8/4Istio_net_control/" class="md-nav__link">
        第四节 流量管理
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap8/5Istio_net_control_exp/" class="md-nav__link">
        第五节 流量管理实验与测试
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap8/6Istio_secruity/" class="md-nav__link">
        第六节 Istio Secuirty
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap8/7Istio_adv_feas/" class="md-nav__link">
        第七节 Istio高级功能
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap8/8Istio_trouble_shoot/" class="md-nav__link">
        第八节 Istio 问题排查
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap8/9Istio_real_instance/" class="md-nav__link">
        第九节 实际案例
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap8/10Istio_terms/" class="md-nav__link">
        第十节 术语表
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_10" type="checkbox" id="__nav_10" >
      
      
      
      
        <label class="md-nav__link" for="__nav_10">
          第九章: Istio日常操作与技巧
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="第九章: Istio日常操作与技巧" data-md-level="1">
        <label class="md-nav__title" for="__nav_10">
          <span class="md-nav__icon md-icon"></span>
          第九章: Istio日常操作与技巧
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap9/1Istio_intro_ppt/" class="md-nav__link">
        第一节 istio浅析 (Slide备案）
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap9/2Istio_security/" class="md-nav__link">
        第二节 Istio 安全最佳实践
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap9/3Istio_service_entry/" class="md-nav__link">
        第三节 记一次 Istio ServiceEntry 的填坑之路
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap9/4Istio_istio_skill/" class="md-nav__link">
        第四节 使用 Istio 的十个技巧
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap9/24Istio_troubleshoot/" class="md-nav__link">
        第五节 Istio 常见的 10 个异常分析
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap9/5istio_interview/" class="md-nav__link">
        第五节 Istio面试
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap9/6k8s_mtls/" class="md-nav__link">
        第六节 Kubernetes 的 mTLS 指南
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap9/8istio_mtls/" class="md-nav__link">
        第七节 如何理解 Istio 中的 mTLS 流量加密？
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_11" type="checkbox" id="__nav_11" >
      
      
      
      
        <label class="md-nav__link" for="__nav_11">
          第10章: Istio架构及发展
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="第10章: Istio架构及发展" data-md-level="1">
        <label class="md-nav__title" for="__nav_11">
          <span class="md-nav__icon md-icon"></span>
          第10章: Istio架构及发展
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap10/1istio_linked_consul/" class="md-nav__link">
        1 Istiovs.Linkerdvs.Consul：服务网格该怎么选择？
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap10/2istio_ambient/" class="md-nav__link">
        2 Istio Ambient Mesh 介绍
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_12" type="checkbox" id="__nav_12" >
      
      
      
      
        <label class="md-nav__link" for="__nav_12">
          第11章: Linkerd
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="第11章: Linkerd" data-md-level="1">
        <label class="md-nav__title" for="__nav_12">
          <span class="md-nav__icon md-icon"></span>
          第11章: Linkerd
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap11/1linkered_sm/" class="md-nav__link">
        1 Linkerd Service Mesh 快速上手
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap11/2linkered_index/" class="md-nav__link">
        2 在 Linkerd 中获取应用的黄金指标
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap11/3linkered_ServiceProfile/" class="md-nav__link">
        3 Linkerd 通过 ServiceProfile 实现超时和重试
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap11/4linkered_mtls/" class="md-nav__link">
        4 在 Linkerd 中使用 mTLS 保护应用程序通信
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap11/5linkerd_flow_split/" class="md-nav__link">
        5 在 Linkerd 中实现流量拆分功能
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap11/6linkered_prod/" class="md-nav__link">
        6 在生产环境中使用 Linkerd
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap11/7linkered_ingress/" class="md-nav__link">
        7 Linkerd 与 ingress-nginx 结合使用以及对服务的访问限制
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap11/8linkerd_212/" class="md-nav__link">
        8 Linkerd 升级到全新的 2.12 版本
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_13" type="checkbox" id="__nav_13" >
      
      
      
      
        <label class="md-nav__link" for="__nav_13">
          extra
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="extra" data-md-level="1">
        <label class="md-nav__title" for="__nav_13">
          <span class="md-nav__icon md-icon"></span>
          extra
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../extra/mk_book/" class="md-nav__link">
        GitHub+Travis+Mkdocs自动化构建文档库(Istio)
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1istio-chart" class="md-nav__link">
    1、Istio Chart概述
  </a>
  
    <nav class="md-nav" aria-label="1、Istio Chart概述">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-1-chartyaml" class="md-nav__link">
    1-1 Chart.yaml
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-2-valuesyaml" class="md-nav__link">
    1-2 values一*.yaml
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-3-requirementsyaml" class="md-nav__link">
    1-3 requirements.yaml
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-4-template_affinitytpl" class="md-nav__link">
    1-4 template/_affinity.tpl
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-5-templatessidecar-injector-configmapyaml" class="md-nav__link">
    1-5 templates/sidecar-injector-configmap.yaml
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-6-templatesconfigmapyaml" class="md-nav__link">
    1-6 templates/configmap.yaml
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-7-templatescrdsyaml" class="md-nav__link">
    1-7 templates/crds.yaml
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-8-charts" class="md-nav__link">
    1-8 charts
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-charts" class="md-nav__link">
    2、 charts全局变量介绍
  </a>
  
    <nav class="md-nav" aria-label="2、 charts全局变量介绍">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2-1-hubtag" class="md-nav__link">
    2-1 hub和tag
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-2-ingressenabled" class="md-nav__link">
    2-2 ingress.enabled
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-3-istio-ingressingress-gateway" class="md-nav__link">
    2-3 Istio并不推荐 ingress的使用方式，建议使用Ingress Gateway, 取而代之
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-4-proxy" class="md-nav__link">
    2-4 Proxy相关参数
  </a>
  
    <nav class="md-nav" aria-label="2-4 Proxy相关参数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1proxyresources" class="md-nav__link">
    1.proxy.resources
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2proxyconcurrency" class="md-nav__link">
    2.proxy.concurrency
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3proxyaccesslogfi1e" class="md-nav__link">
    3.Proxy.accessLogFi1e
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-proxyprivileged" class="md-nav__link">
    4. proxy.privileged
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5proxyenablecoredump" class="md-nav__link">
    5.Proxy.enableCoreDump
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6proxyincludeipranges" class="md-nav__link">
    6.proxy.includeIPRanges
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7-proxyexcludeipranges" class="md-nav__link">
    7. Proxy.excludeIPRanges
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8proxyincludeinboundports" class="md-nav__link">
    8.Proxy.includeInboundPorts
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#9proxyexcludeinboundports" class="md-nav__link">
    9.proxy.excludeInboundports
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#10proxyautoinject" class="md-nav__link">
    10.proxy.autoInject
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#11-proxyenvoystatsd" class="md-nav__link">
    11. proxy.envoyStatsd
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-4-proxy_initimage" class="md-nav__link">
    2-4 proxy_init.image
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-5-imagepullpolicy" class="md-nav__link">
    2-5 imagePullPolicy
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-6-controlplanesecurityenabled" class="md-nav__link">
    2-6 controlPlaneSecurityEnabled
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-7-disablepolicychecks" class="md-nav__link">
    2-7 disablePolicyChecks
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-8-enabletracing" class="md-nav__link">
    2-8 enableTracing
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-9-mtlsenabled" class="md-nav__link">
    2-9 mtls.enabled
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-10-imagepullsecrets" class="md-nav__link">
    2-10 imagePullSecrets
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-11-arch" class="md-nav__link">
    2-11 arch
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-12-onenamespace" class="md-nav__link">
    2-12 oneNamespace
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-13-configvalidation" class="md-nav__link">
    2-13 configValidation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-14-meshexpansion" class="md-nav__link">
    2-14 meshExpansion
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-15-meshexpansionilb" class="md-nav__link">
    2-15 meshExpansionILB
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-16-defaultresources" class="md-nav__link">
    2-16 defaultResources
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-17-hyperkube" class="md-nav__link">
    2-17 hyperkube
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-18-priorityclassname" class="md-nav__link">
    2-18 priorityClassName
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-19-crds" class="md-nav__link">
    2-19 crds
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3istio" class="md-nav__link">
    3、Istio 安装清单的生成和部署
  </a>
  
    <nav class="md-nav" aria-label="3、Istio 安装清单的生成和部署">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#3-1-valuesyaml" class="md-nav__link">
    3-1 编辑values.yaml
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-2" class="md-nav__link">
    3-2 系统资源
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-3" class="md-nav__link">
    3-3 服务类型
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-4" class="md-nav__link">
    3-4 可视化组件的服务开放
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4" class="md-nav__link">
    4、生成部署清单
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5istio" class="md-nav__link">
    5、部署Istio
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6" class="md-nav__link">
    6、小结
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  <a href="https://github.com/Chao-Xi/jxistiobook.git/edit/master/docs/chap5/4Istio_Helm.md" title="编辑此页" class="md-content__button md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>


<h1 id="helmistio"><strong>第四节 用<code>Helm</code>部署<code>Istio</code></strong></h1>
<p><code>Istio</code> 是由多个组件构成的，井且可以通过 <code>kubectl</code> 命令在<code>Kubernetes</code>集群上进行部署，部署时会在<code>Kubernetes</code>集群上创建大量的对象。<code>Istio</code>与<code>Kubernetes</code>进行了深度集成，构成<code>Istio</code>的各个组件都以<code>Deployment</code> 的形式在<code>Kubernetes</code>集群中运行，并且其在运行过程中所需的配置数据也需要依赖各种<code>CRD</code>及<code>ConfigMap</code>、 <code>Secret</code>等来进行存储。这种包含复杂依赖关系的应用部署 过程，需要由功能足够强大的模板系统提供支持，因此<code>Istio</code>官方推荐使用<code>Helm</code>对<code>Istio</code>进行部署。</p>
<p>本章将会较为详细地对一<code>Istio</code>的<code>Helm Chart</code>部署方式进行讲解。</p>
<h2 id="1istio-chart"><strong>1、Istio Chart概述</strong></h2>
<p><code>Helm</code>是目前<code>Istio</code>官方推荐的安装方式。除去安装后，我们还可以对输人值进行一些调整，完成对<code>Istio</code>的部分配置T作。<code>Istio Chart</code>是一个总分结构，其分级结构和设计结构是一致的.</p>
<p><code>Istio</code>中<code>Chart</code>的分级结构和目录结构是对等的，下面进行简要说明。 </p>
<h3 id="1-1-chartyaml"><strong>1-1 Chart.yaml</strong></h3>
<p>该文件是<code>Chart</code>的基础信息文件，其中包含版本号、名称、关键字等元数据信息。 </p>
<p><img alt="Alt Image Text" src="../../images/bok/4_1.png" title="Body image" /></p>
<h3 id="1-2-valuesyaml"><strong>1-2 <code>values一*.yaml</code></strong></h3>
<p>在<code>Istio</code>的发行包中包含一组<code>values</code>文件，提供<code>Istio</code>在各种场景下的关键配置范本，这些范本文件可以作为<code>Helm</code>的输入文件，来对<code>Istio</code>进行典型定制。对<code>Istio</code>的定制可以从对这些输人文件的改写开始，在改写完成后使用<code>helm template</code>命令生成最终的部署文件，这样就能用<code>kubectl</code>完成部署了。</p>
<ul>
<li>下面列举这些典型输人文件的作用。<code>values_istio_auth-galley.yaml</code>：启用控制面<code>mTLS</code>,默认打开网格内部的<code>mTLS</code>, 启用<code>Galley</code> </li>
<li><code>values-istio-multicluster.yaml</code>：多集群配置。 </li>
<li><code>values-istio-auth-multicluster.yaml</code>：多集群配置，启用控制面<code>mTLS</code>，默认打开网格内部的<code>mTLS</code>禁用自签署证书 。</li>
<li><code>values-isito-demo-auth.yml</code>: 启用控制面<code>mTLS</code>默认打开网格内部的<code>mTLs</code></li>
<li><code>values-istio-auth.yaml</code>: 启用控制面<code>mTLS</code>默认打开网格内部的<code>Grafana</code>, <code>Jaeger</code> <code>ServiceGraph</code> 及<code>Galley</code>,允许自动注入</li>
<li><code>values-istio-galley.yaml</code>: 启用<code>Galley</code>和<code>Prometheus</code></li>
<li><code>values-istio-gateways.yaml</code>: 这是一个样例可以用这种形式定义新的<code>Gateway</code>。</li>
<li><code>values-istio-one-namespace.yaml</code>: 单命名空间部署, 默认打开网格内部的<code>mTLS</code></li>
<li><code>values-istio-one-namespace-auth.yaml</code>: 单命名空间部署， 启用控制面<code>mTLS</code> </li>
<li><code>values.yaml</code>: 罗列了绝大多数常用变量，也是我们做定制的基础 </li>
</ul>
<h3 id="1-3-requirementsyaml"><strong>1-3 <code>requirements.yaml</code></strong></h3>
<p>该文件用于管理对子<code>Chart</code>的依赖关系，其中定义了一系列开关变量。 </p>
<p>在<code>Helm</code>的输人内容中对相关变量进行定义，就可以对<code>Istio</code>的部署文件进行修改，来控制对应组件的启用状态。例如，其中有一段对<code>Grafana</code>的控制代码： </p>
<pre><code>- name: grafana 
  version: 1.0.3 
  condition:grafana.enabled
</code></pre>
<p>这段控制代码代表：如果修改全局变量<code>grafana.enabled</code>为<code>False</code>,就不会安装<code>Grafana</code>了。 </p>
<h3 id="1-4-template_affinitytpl"><strong>1-4 <code>template/_affinity.tpl</code></strong></h3>
<p><strong>该文件会生成一组节点亲和或互斥元素，供各个组件在渲染YAML时使用该文件里使用了一系列变量，用于控制<code>Istio</code>组件的节点亲和性</strong>（也就是限制在部署时对节点的选择。</p>
<p>在模板中引用了全局变量<code>arch</code>，默认内容是： </p>
<pre><code>arch: 
 amd64:2 
 s390x:2 
 ppc64le:2 
</code></pre>
<p>这里定义如下两个局部模板： </p>
<ul>
<li><code>nodeAffinityRequiredDuringScheduling</code>：会根据全局变量中的<code>arch</code>参数对部署节点进行限制。<code>Istio</code>组件的<code>Pod</code>会根据<code>arch</code>参数中的服务器类型列表来决定是否部署到某一台服务器上，并根据各种服务器类型的不同权重来决定优先级。 </li>
<li><code>nodeAffinityPreferredDuringScheduling</code>：跟上一个变量的作用类似，不同的是，这一个软限制。 </li>
</ul>
<p>接下来会使用在上面定义的两个模板生成新模板，将其命名为<code>nodeaffinity</code>，并提供给其他组件引用，用于生成各个组件<code>Deployment</code>对象的节点亲和性限制。 </p>
<h3 id="1-5-templatessidecar-injector-configmapyaml"><strong>1-5 <code>templates/sidecar-injector-configmap.yaml</code></strong></h3>
<p><strong>根据文件名就可以判断出来，该文件最终会用于生成一个<code>ConfigMap</code>对象，在该对象中保存的配置数据被用于进行<code>Sidecar</code>注入。</strong></p>
<p><code>istioctl</code>完成的手工注人，或者 <code>Istioctl</code> 的自动注人，都会引用这个<code>ConfigMap</code>，换句话说，如果希望修改<code>Istio</code>的<code>Sidecar</code>的注人过程及具体行为，就可以从该文件或者对应的<code>ConfigMap</code>人手了。 </p>
<h3 id="1-6-templatesconfigmapyaml"><strong>1-6 <code>templates/configmap.yaml</code></strong></h3>
<p>该文件也会生成一个<code>ConfigMap</code>，名称为<code>istio</code>，这个对象用于为<code>Pilot</code>提供启动配置数据。 </p>
<h3 id="1-7-templatescrdsyaml"><strong>1-7 <code>templates/crds.yaml</code></strong></h3>
<p>该文件包含了<code>Istio</code>所需的<code>CRD</code>定义，它的部署方式较为特殊： </p>
<ul>
<li>如果使用<code>Helm 2.10</code>之前的版本进行安装，则需要先使用<code>kubectl</code>提交该文件到<code>Kubernetes</code>集群中； </li>
<li>如果使用<code>Helm 2.10</code>之后的版本，则其中的<code>Helm hook</code>会自动提前安装，无须特别注意。 </li>
</ul>
<h3 id="1-8-charts"><strong>1-8 <code>charts</code></strong></h3>
<p>这个目录中的子目录就是<code>Istio</code>的组件，如下所述。 </p>
<ul>
<li><code>certrnanager</code>：一个基于<code>Jetstack Cert-Manager</code>项目的<code>ACME</code>证书客户端，用于自动进行证书的申请、获取及分发。 </li>
<li><code>galley</code>: <strong><code>Istio</code>利用<code>Galley</code>进行配置管理工作</strong>。</li>
<li><code>gateways</code>：<strong>对<code>Gateways Chart</code>进行配置，可以安装多个<code>Gateway Controller</code>,</strong></li>
<li><code>grafana</code>：图形化的<code>Istio Dashboard</code> </li>
<li><code>ingress</code>：一个遗留设计，默认关闭，在流量控制协议升级到<code>network.istio.io/vlalpha3</code>之后，已经建议弃用。 </li>
<li><code>kiali</code>：<strong>带有分布式跟踪、配置校验等多项功能的<code>Dashboard</code></strong>。</li>
<li><code>mixer</code>: <code>Istio</code>的策略实施组件。</li>
<li><code>pilot</code>: <code>Istio</code>的流量管理组件。 </li>
<li><code>prometheus</code>： 监控软件<code>Prometheus</code>,其中包含<code>Istio</code>特定的指标抓取设置。 </li>
<li><code>security</code>: <code>Citadel</code>组件，用于证书的自动管理 </li>
<li><code>servicegraph</code>：分布式跟踪组件，用于获取和展示服务调用关系图，即将废除</li>
<li><code>sidecarInjectorWebhook</code>: 自动注人<code>Webhook</code>的相关配置； </li>
<li><code>tracing</code>：分布式跟踪组件，使用<code>Jaeger</code>实现，替代原有的<code>Service Graph</code>组件。 </li>
</ul>
<h2 id="2-charts">2、 <code>charts</code>全局变量介绍</h2>
<p>我们在使用现有<code>Chart</code>的时候，通常都不会修改<code>Chart</code>的本体，仅通过对变量的控制来实现对部署过程的定制。<code>Istio Helm Chart</code>提供了大量的变量来帮助用户对 <code>Istio</code>的安装进行定制。 </p>
<p><code>Istio Chart</code>分为父子两层，因此变量也具有全局和本地两级。 全局变量使用保留字<code>global</code> 进行定义，子<code>Chart</code>可以通过<code>Values.global</code>的方式引用全局变量，而在主<code>Chart</code>中也可以用<code>chart.var</code>的方式为子<code>Chart</code>指定变量值。 </p>
<h3 id="2-1-hubtag"><strong>2-1 <code>hub</code>和<code>tag</code></strong></h3>
<p>在多数情况下，这两个变量代表所有镜像的地址，具体名称一般以 <code>｛{ .Values. global.hub}}/[component]/:{{ .Values.global.tag }｝</code> 的形式拼接而成。</p>
<p>在 <code>proxy_init</code>、<code>Mixer</code>、 <code>Grafana</code> 和 <code>Pilot</code>的<code>Deployment</code>模板中, </p>
<p><strong>一旦在其<code>image</code>变量中 包含路径符<code>“/"</code>,则会弃用<code>global.hub</code>，直接采用<code>image</code>的定义，</strong></p>
<p>代码如下： </p>
<pre><code>{{- if contains &quot;/&quot; .Values.image }}
        image: &quot;{{ .Values.image }}&quot;
{{- else }}
        image: &quot;{{ $.Values.global.hub }}/{{ $.Values.image }}:{{ $.Values.global.tag }}&quot;
{{- end }}
</code></pre>
<p>这两个变量对于内网部署是非常有必要的，将<code>istio</code>的镜像拉取回来，井推送至私库之后．只要在<code>Values.yaml</code> 中进行修改、就可以将<code>Istio</code>所需镜像的引用指向内网私库．省去了逐个修改<code>Deployment</code>文档的麻烦 </p>
<h3 id="2-2-ingressenabled"><strong>2-2 <code>ingress.enabled</code></strong></h3>
<p><strong>这个开关用来控制是否启用<code>Istio</code> 的<code>Ingress Controller</code>.</strong></p>
<p><strong>如果这个值被设置为<code>True</code> 就会启用时<code>Kubernetes Ingress</code>资源的支持，这是一个兼容的功能</strong></p>
<h3 id="2-3-istio-ingressingress-gateway"><strong>2-3 <code>Istio</code>并不推荐 <code>ingress</code>的使用方式，建议使用<code>Ingress Gateway</code>, 取而代之</strong></h3>
<p><strong>有两个变量会受到这个开关的影啊，这两个变量分别是<code>k8sIngressSelector</code>和 <code>k8sIngressHttps</code> 只有在<code>ingress.enabled</code>被设置为<code>True</code>的情况下，这两个变量的相关内容才会生效</strong>。 </p>
<ul>
<li><code>k8sIngresSelector</code>会利用<code>Pod</code>标签选择一个<code>Gateway</code>，作为<code>Ingress Controller</code> </li>
<li>如果将<code>k8sIngressHttps</code>变量赋值为<code>True</code>，就会在<code>istio-autogenerated-k8s-in gress</code> 这个<code>Gateway</code>定义中加入<code>443</code>端口及其<code>TLS</code>配置.</li>
</ul>
<p><code>k8sIngressHttps</code>的相关引用对<code>Ingress Gateway Pod</code>的<code>/etc/istio/ingress/certs／</code>下的证书文件有依赖．</p>
<p>因此需要启用这一选项：需要把<code>ingress.enabled</code>设置为<code>true</code>。</p>
<ul>
<li>从而成功创建<code>ingress Chart</code>的<code>Deployment</code>；</li>
<li>还需要创建一个被命名为<code>Ingress-certs</code>的<code>tls secret</code>给<code>istio-ingress Deployment</code> 进行加载。如果没有满足这些条件，<code>LDS</code>就会拒绝服务，从而无法提供<code>Ingress</code>功能.</li>
</ul>
<h3 id="2-4-proxy"><strong>2-4 Proxy相关参数</strong></h3>
<p>在<code>values.yaml</code>中定义一组<code>Proxy</code>变量, 用于对<code>Sidecar</code>进行控制。  </p>
<h4 id="1proxyresources"><strong>1.<code>proxy.resources</code></strong></h4>
<p>用于为<code>Sidecar</code>分配资源。用户可以根据业务Pod的负载情况, 为<code>Sidecar</code>指定<code>CPU</code>和内存资源。 </p>
<h4 id="2proxyconcurrency"><strong>2.<code>proxy.concurrency</code> </strong></h4>
<p><code>Proxy worker</code> 数量进行分配。如果被设置为0（默认值），则根据<code>CPU</code>线程或核的数量进行分配。</p>
<h4 id="3proxyaccesslogfi1e"><strong>3.<code>Proxy.accessLogFi1e</code></strong></h4>
<p><code>Sidecar</code>的访问日志位置。 如果被设置为空字符串，则关闭访问日志功能。默认值为<code>/dev/stdout</code>。 </p>
<h4 id="4-proxyprivileged"><strong>4. <code>proxy.privileged</code></strong></h4>
<p><code>istio-init</code>、<code>istio-proxy</code>的特权模式开关。默认值为<code>false</code>。 </p>
<h4 id="5proxyenablecoredump"><strong>5.<code>Proxy.enableCoreDump</code></strong></h4>
<p>如果打开, 则新注人的<code>Sidecar</code>会启动<code>CoreDump</code>功能， 在<code>Pod</code>中加人初始化容器 
<code>enable-core-dump</code>默认值为<code>false</code> </p>
<h4 id="6proxyincludeipranges"><strong>6.<code>proxy.includeIPRanges</code></strong></h4>
<p>劫持<code>IP</code>范围的白名单。默认值为<code>“*"</code>，也就是劫持所有地址的流量。</p>
<p>在<code>sidecar-injector-configmap.yaml</code>中应用了这一变量，用于生成<code>istio-sidecar-injector</code>这个<code>ConfigMap</code>，这个<code>ConfigMap</code>设置了<code>istio-init</code>的运行参数，通过对<code>istio-init</code>的<code>"-i”</code>参数进行修改来完成这一任务。 </p>
<h4 id="7-proxyexcludeipranges"><strong>7. <code>Proxy.excludeIPRanges</code></strong></h4>
<p>劫持<code>IP</code>范围的黑名单。默认值为空字符串, 也就劫持范围以外的IP。同<code>proxy.includeIPRanges</code> 的情况类似。它影响的是<code>istio-init</code>的<code>-x</code>参数</p>
<h4 id="8proxyincludeinboundports"><strong>8.<code>Proxy.includeInboundPorts</code></strong></h4>
<p>入站流量的端口劫持白名单。所有从范围内的端口进入Pod的流量都会被劫持。它影响的是<code>istio-init</code>的<code>"-b"</code>参数</p>
<h4 id="9proxyexcludeinboundports"><strong>9.<code>proxy.excludeInboundports</code></strong></h4>
<p>入站流量的端口劫持黑名单。这一端口范围之外的入站流量才会被劫持。 它影响的是<code>Istio-init</code>的<code>“-d”</code>参数。 </p>
<h4 id="10proxyautoinject"><strong>10.<code>proxy.autoInject</code></strong></h4>
<p><strong>用于控制是否自动完成<code>Sidecar</code>的注入工作。</strong> </p>
<h4 id="11-proxyenvoystatsd"><strong>11. <code>proxy.envoyStatsd</code></strong></h4>
<p>该变量的默认值如下。 </p>
<ul>
<li><code>enabled:true</code> </li>
<li><code>host:istio-statsd-prom-bridge</code> </li>
<li><code>port:9125</code> </li>
</ul>
<p>它会设置<code>Envoy</code>的<code>“--statsdUdpAddress”</code>参数，在某些参数下（例如没有安装 <code>Mixer</code>）可以关闭。 </p>
<h3 id="2-4-proxy_initimage"><strong>2-4 <code>proxy_init.image</code></strong></h3>
<p>网格中的服务<code>Pod</code>在启动之前，首先会运行一个初始化镜像来完成流量劫持工作，这个变量可以用于指定初始化容器镜像。 </p>
<h3 id="2-5-imagepullpolicy"><strong>2-5 <code>imagePullPolicy</code></strong></h3>
<p>镜像的拉取策略。默认值为<code>“IfNotPresent"</code>.</p>
<h3 id="2-6-controlplanesecurityenabled"><strong>2-6 <code>controlPlaneSecurityEnabled</code></strong></h3>
<p><strong>指定是否在<code>Istio</code>控制面组件上启用<code>mTLS</code>通信。</strong></p>
<p>在启用之后，<code>Sidecar</code>和控制平面组件之间，以及控制平面组件之间的通信，都会被改为<code>mTLS</code>方式。受影响的组件包括<code>Ingress</code>. <code>Mixer</code>, <code>Pilot</code>及<code>Sidecar</code>.</p>
<h3 id="2-7-disablepolicychecks"><strong>2-7 <code>disablePolicyChecks</code></strong></h3>
<p>如果把这个开关变量设置为<code>true</code>，则会禁用<code>Mixer</code>的预检功能。预检功能是一个同步过程，有可能因为预检缓慢造成业务应用的阻塞。 </p>
<h3 id="2-8-enabletracing"><strong>2-8 <code>enableTracing</code></strong></h3>
<p>是否启用分布式跟踪功能，默认值为<code>true</code> </p>
<h3 id="2-9-mtlsenabled"><strong>2-9 <code>mtls.enabled</code></strong></h3>
<p>所有服务之问的通信都会使用<code>mTLS</code>进行安全加固。需要注意的是，这一变量的设置是全局的，对于每个服务还以单独使用目标规则或者服务注解的方式，自行诀定是否采用<code>mTLS</code>加固</p>
<h3 id="2-10-imagepullsecrets"><strong>2-10 <code>imagePullSecrets</code></strong></h3>
<p>用于为<code>ServiceAccount</code>分配在镜像拉取过程中所需的认证凭据。默认值为空值 </p>
<h3 id="2-11-arch"><strong>2-11 <code>arch</code></strong></h3>
<p>在设置<code>Istio</code>组件的节点亲和性过程中，会使用这一变量的列表内容来确定可以用于部署的节点范围，并按照不同的服务器架构设置了优先顺序。它的默认列表内容如下： </p>
<ul>
<li><code>amd64:2</code> </li>
<li><code>s390x:2</code></li>
<li><code>ppc64le:2</code></li>
</ul>
<h3 id="2-12-onenamespace"><strong>2-12 <code>oneNamespace</code></strong></h3>
<p>默认值为<code>false</code>, <code>Pilot</code>会监控所有命名空间内的服务变化如果这个变量被设置为<code>true</code>，则会在<code>Pilot</code>的服务发现参数中加入<code>"-a"</code>, 在这种情况下，<code>Pilot</code>只会对<code>Istio</code>组件所在的命名空间进行监控。 </p>
<h3 id="2-13-configvalidation"><strong>2-13 <code>configValidation</code></strong></h3>
<p>用于配置是否开启服务端的配置验证。默认值为<code>true</code>. 该选项在开启之后， 会生成一个<code>ValidatingWebhook Configuration</code> 对象，并被包含到<code>Galley</code>的配置中，从而启用校验功能。</p>
<h3 id="2-14-meshexpansion"><strong>2-14 <code>meshExpansion</code></strong></h3>
<p>要将服务网格扩展到物理机或者虚拟机上，就会使用到这一变量。默认值为<code>false</code> 如果被设置为<code>true</code>，则会在<code>Ingress Gateway</code>上公开<code>Pilot</code>和<code>Citadel</code>的服务。 </p>
<h3 id="2-15-meshexpansionilb"><strong>2-15 <code>meshExpansionILB</code></strong></h3>
<p><strong>是否在内部网关中公开<code>Pilot</code>和<code>Citadel</code>的端口。</strong></p>
<p>默认值为<code>false</code>，仅在服务网格扩展时会使用到这一变量。</p>
<h3 id="2-16-defaultresources"><strong>2-16 <code>defaultResources</code></strong></h3>
<p>为所有<code>Istio</code>组件都提供一个最小资源限制。在默认情况下，只设置一个请求<code>10m Cpu</code>资源的值。可以在各个<code>Chart</code>的局部变量中分别设置资源需求。 </p>
<h3 id="2-17-hyperkube"><strong>2-17 <code>hyperkube</code></strong></h3>
<p>在<code>Istio</code>的设置过程会使用一个镜像执行一些<code>Job</code>，例如在早期版本安装过程中的<code>CRD</code>初始化，或者现在的清理过期证书等任务。这个镜像默认使用的是 <code>quay.io/coreos:v1.7.6_coreos.0</code>，在内网中同样可以对其进行覆盖。 </p>
<h3 id="2-18-priorityclassname"><strong>2-18 <code>priorityClassName</code></strong></h3>
<p><code>Kubernetes</code>在<code>1.11.0</code>以上版本中提出了<code>PriorityClass</code>的概念，<strong>具有优先级的<code>Pod</code> 
不会被驱逐或抢占资源。该变量的默认值为空，可选值包括<code>“system-cluster-critical"</code> 和<code>"system-node-critical"</code></strong>。 </p>
<h3 id="2-19-crds"><strong>2-19 <code>crds</code></strong></h3>
<p>该变量用于决定是否包含<code>CRD</code>定义。如果使用<code>helm templat</code>e命令，或者是<code>2.10</code>以土版本的<code>helm install</code>命令，则应该将其设置为<code>true</code>;</p>
<p>否则在安装之前首先要执行 <code>kubectl apply -f install/kubernetes/helm/istio/templates/crds.yaml</code>，并将该变量设置为 <code>false</code>。 </p>
<h2 id="3istio"><strong>3、Istio 安装清单的生成和部署</strong></h2>
<h3 id="3-1-valuesyaml"><strong>3-1 编辑<code>values.yaml</code></strong></h3>
<p>我们需要先根据实际需求对<code>Istio</code>进行定制，<code>values.yaml</code>。最常见的修改包含以下内容。 </p>
<ul>
<li>镜像地址 </li>
</ul>
<p>如果是内网部署，那么需要先解决镜像地址问题。我们通常会在具备外网连接条件的服务器上拉取所需镜像，然后导出镜像，将其推送到本地私有镜像库。那么， 如何知道我们需要哪些镜像？ </p>
<p>我们可以<code>grep istio-demo.yaml</code></p>
<pre><code>$ cd Istio/istio-1.1.16/install/kubernetes

$ grep -r image: istio-demo.yaml | egrep -o -e &quot;image:.*&quot; | sort | uniq
image: &quot;docker.io/istio/citadel:1.1.16&quot;
image: &quot;docker.io/istio/galley:1.1.16&quot;
image: &quot;docker.io/istio/kubectl:1.1.16&quot;
image: &quot;docker.io/istio/kubectl:1.1.16&quot;
image: &quot;docker.io/istio/mixer:1.1.16&quot;
image: &quot;docker.io/istio/pilot:1.1.16&quot;
image: &quot;docker.io/istio/proxy_init:1.1.16&quot;
image: &quot;docker.io/istio/proxyv2:1.1.16&quot;
image: &quot;docker.io/istio/sidecar_injector:1.1.16&quot;
image: &quot;docker.io/jaegertracing/all-in-one:1.9&quot;
image: &quot;docker.io/kiali/kiali:v0.16&quot;
image: &quot;docker.io/prom/prometheus:v2.3.1&quot;
image: &quot;grafana/grafana:6.0.2&quot;
image: [[ annotation .ObjectMeta `sidecar.istio.io/proxyImage`  &quot;docker.io/istio/proxyv2:1.1.16&quot;  ]]
</code></pre>
<p>在得到这些镜像名称之后，就可以逐个进行镜像的拉取和推送操作了。 </p>
<p>接下来根据私库地址，修改<code>values.yaml</code>中各个镜像的地址，生成新的安装清单文件，然后重新用上述命令进行检查即可。 </p>
<h3 id="3-2"><strong>3-2 系统资源</strong></h3>
<p><code>Values.yaml</code>中的系统资源设置是非常保守的，并且不够完整，因此这里建议根据实际隋况调整各个组件的资源分配。</p>
<h3 id="3-3"><strong>3-3 服务类型</strong></h3>
<p><code>Istio</code>的<code>Istio-ingressgateWay</code>服务的默认类型是<code>Loadbalancer</code>，如果在要部署的
目标<code>Kubernetes</code>集群中没有负载均衡支持，就需要对服务类型进行修改了</p>
<h3 id="3-4"><strong>3-4 可视化组件的服务开放</strong></h3>
<p>在<code>Istio</code>中包含了<code>Prometheus</code>, <code>Grafana</code>及<code>Kiali</code>等可视化组件，在默认状态下都是<code>ClusterIP</code>类型的，要顺利使用，则可能需要为其分配<code>Ingress</code>或者修改服务类型。 </p>
<h2 id="4"><strong>4、生成部署清单</strong></h2>
<p>在完成对<code>values.yaml</code> 的编辑之后，就可以使用<code>helm template</code>命令来生成最终的 \部署清单文件了，例如我们生成的输人文件为<code>my-values.yaml</code>，那么可以用如下命令生成我们需要的YAML文件： </p>
<pre><code>$ helm template install/kubernetes/helm/istio  \
--namespace istio一system \ 
-f my-values.yaml&gt;my-istio.yaml
</code></pre>
<p>这个命令假设我们的当前目录是<code>Istio</code>发行包的根目录，其中： </p>
<ul>
<li><code>"--name istio”</code> 代表生成的部署内容的基础名称为“istio"; </li>
<li><code>"--namespace istio-system”</code>代表将<code>Istlo</code>部署到命名空间 "istio-system”中；</li>
<li><code>"-f my-values.yaml”</code>代表从<code>my-values.yaml</code>文件中获取输人的内容。 </li>
</ul>
<p>该命令在执行完毕之后，会生成部署清单文件<code>my-istio.yaml</code>，可以打开该文件，检查其中的内容是否符合预期。 </p>
<h2 id="5istio"><strong>5、部署Istio</strong></h2>
<p>在部署清单生成并检查完毕之后，就可以开始部署了。 </p>
<p>我们生成的<code>my-istio.yaml</code>是要求部署到<code>istio-system</code>命名空间的，所以这里使用<code>kubectl</code>命令来创建它： </p>
<pre><code>$ kubectl create ns istio-system 
namespace/istio-system created 
</code></pre>
<pre><code>kubectl apply -f my-istio.yaml 
configmap/istio-galley-configuration created 
configmap/istio-statsd-prom-bridge created 
configmap/prometheus created 
configmap/istio-security-custom-resources created 
</code></pre>
<p>等运行结束之后，同样可以使用<code>“kubecti get po -n istio-system -w”</code>命令来查看 <code>Pod</code>的运行情况，直到全部<code>Pod</code>成功进人<code>Running</code>或者<code>Completed</code>状态，<code>Istio</code>的安装部署工作就完成了。 </p>
<h2 id="6"><strong>6、小结</strong></h2>
<p>Helm还有一种常见的部署方式，就是通过<code>helm install</code>命令进行部署。但是，采用这种部署方式时，需要在<code>Kubernetes</code>中部署<code>Tiller</code>：服务端，而且不会生成部署清单文件，<strong>这对于配置管理来说是很不方便的，因此这里不做推荐。</strong></p>
<p>另外，在<code>Helm</code>的<code>template</code>或者<code>install</code>命令中，可以通过<code>“--set”</code>的方式来设置 
变量值。这里没有提及这种方式，原因很简单：<code>Istio</code>部署过程中涉及的变量太多，命令行方式更显笨重。 </p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="页脚" >
      
        
        <a href="../3Istro_ServiceM_Prac/" class="md-footer__link md-footer__link--prev" aria-label="上一页: 第三节 Istio, Service Mesh 快速入门（Istio 1.1.16）" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                上一页
              </span>
              第三节 Istio, Service Mesh 快速入门（Istio 1.1.16）
            </div>
          </div>
        </a>
      
      
        
        <a href="../5Istio_funcs/" class="md-footer__link md-footer__link--next" aria-label="下一页: 第五节 Istio 常用功能 （自动/手动部署Istio应用）" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                下一页
              </span>
              第五节 Istio 常用功能 （自动/手动部署Istio应用）
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2021-9999 Jacob Xi
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.ecf98df9.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.config.lang": "ja", "search.config.pipeline": "trimmer, stemmer", "search.config.separator": "[\\s\\-\uff0c\u3002]+", "search.placeholder": "\u641c\u7d22", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version.title": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.39f04ddb.min.js"></script>
      
    
  </body>
</html>